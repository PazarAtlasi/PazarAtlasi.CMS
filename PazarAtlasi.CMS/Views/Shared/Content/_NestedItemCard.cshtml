@model PazarAtlasi.CMS.Models.ViewModels.SectionItemViewModel
@{
    var nestedConfig = ViewBag.NestedConfig as PazarAtlasi.CMS.Application.Dtos.NestedSectionConfiguration;
    var parentTempId = ViewBag.ParentTempId as string;
    var nestedIndex = ViewBag.NestedIndex as int? ?? 0;
    var availableLanguages = ViewBag.AvailableLanguages as List<PazarAtlasi.CMS.Models.ViewModels.LanguageViewModel> ?? new List<PazarAtlasi.CMS.Models.ViewModels.LanguageViewModel>();
}

<div class="nested-item-card bg-purple-50 border border-purple-200 rounded p-3" data-nested-id="@Model">
    <div class="flex items-center justify-between mb-2">
        <span class="text-xs font-medium text-slate-600">
            <i class="fas fa-link mr-1"></i> Dropdown #@(nestedIndex + 1)
        </span>
        @if (nestedConfig?.AllowDynamicItems == true)
        {
            <button type="button" onclick="SectionModal.removeNestedItem('@parentTempId', '@Model')"
                    class="text-red-500 hover:text-red-700 text-xs">
                <i class="fas fa-times"></i>
            </button>
        }
    </div>
    <div class="space-y-2">
        @if (nestedConfig?.Fields != null)
        {
            @foreach (var field in nestedConfig.Fields)
            {
                ViewBag.Field = field;
                ViewBag.NestedItem = Model;
                ViewBag.ParentTempId = parentTempId;
                ViewBag.Value = Model.Data?.ContainsKey(field.Name) == true ? Model.Data[field.Name]?.ToString() : field.DefaultValue ?? "";
                ViewBag.AvailableLanguages = availableLanguages;
                
                @await Html.PartialAsync("~/Views/Shared/Content/_SectionItemNestedField.cshtml", field)
            }
        }
    </div>
</div>