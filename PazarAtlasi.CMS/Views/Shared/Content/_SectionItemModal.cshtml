@model PazarAtlasi.CMS.Models.ViewModels.SectionItemModalViewModel

<div class="section-item-modal bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto" style="max-height: 90vh; overflow-y: auto;">
    <div class="sticky top-0 bg-white border-b border-slate-200 px-6 py-4 z-10">
        <div class="flex items-center justify-between">
            <h3 class="text-xl font-semibold text-slate-800">
                @if (Model.IsNew)
                {
                    <span><i class="fas fa-plus-circle mr-2 text-purple-600"></i> Add Section Item</span>
                }
                else
                {
                    <span><i class="fas fa-edit mr-2 text-purple-600"></i> Edit Section Item</span>
                }
            </h3>
            <button type="button" onclick="closeSectionItemModal()" class="text-slate-400 hover:text-slate-600">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <p class="text-sm text-slate-500 mt-1">Section: @Model.SectionCode (@Model.SectionType.ToString())</p>
    </div>

    <form id="sectionItemForm" class="p-6 space-y-6">
        <input type="hidden" id="itemId" value="@Model.Id" />
        <input type="hidden" id="sectionId" value="@Model.SectionId" />
        
        <!-- Basic Settings -->
        <div class="bg-slate-50 rounded-lg p-4">
            <h4 class="font-medium text-slate-800 mb-4 flex items-center">
                <i class="fas fa-cog mr-2 text-purple-600"></i> Basic Settings
            </h4>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Item Code</label>
                    <input type="text" id="itemCode" value="@Model.Code" 
                           class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-200 focus:border-purple-400"
                           placeholder="e.g., hero-item-1" />
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Sort Order</label>
                    <input type="number" id="itemSortOrder" value="@Model.SortOrder" 
                           class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-200 focus:border-purple-400"
                           min="0" />
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Item Type</label>
                    <select id="itemType" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-200 focus:border-purple-400" onchange="handleItemTypeChange(this.value)">
                        @foreach (var type in Enum.GetValues<PazarAtlasi.CMS.Domain.Common.SectionItemType>())
                        {
                            var enumValue = (int)type;
                            @if (Model.Type == type)
                            {
                                <option value="@enumValue" selected>@type.ToString()</option>
                            }
                            else
                            {
                                <option value="@enumValue">@type.ToString()</option>
                            }
                        }
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Status</label>
                    <select id="itemStatus" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-200 focus:border-purple-400">
                        @foreach (var status in Enum.GetValues<PazarAtlasi.CMS.Domain.Common.Status>())
                        {
                            @if (Model.Status == status)
                            {
                                <option value="@status" selected>@status.ToString()</option>
                            }
                            else
                            {
                                <option value="@status">@status.ToString()</option>
                            }
                        }
                    </select>
                </div>
            </div>
        </div>

        <!-- Media Settings (for Image/Video/Gallery types) -->
        <div id="mediaSettingsPanel" class="bg-purple-50 rounded-lg p-4 border border-purple-200" style="display: none;">
                <h4 class="font-medium text-slate-800 mb-4 flex items-center">
                    <i class="fas fa-image mr-2 text-purple-600"></i> Media Settings
                </h4>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Media Type</label>
                    <div class="grid grid-cols-3 gap-3">
                        <button type="button" onclick="selectMediaType('Image')" 
                                class="media-type-btn @(Model.MediaType == PazarAtlasi.CMS.Domain.Common.MediaType.Image ? "active" : "")"
                                data-media-type="Image">
                            <i class="fas fa-image text-2xl mb-2"></i>
                            <span class="text-sm font-medium">Single Image</span>
                        </button>
                        
                        <button type="button" onclick="selectMediaType('ImageSlider')" 
                                class="media-type-btn @(Model.MediaType == PazarAtlasi.CMS.Domain.Common.MediaType.ImageSlider ? "active" : "")"
                                data-media-type="ImageSlider">
                            <i class="fas fa-images text-2xl mb-2"></i>
                            <span class="text-sm font-medium">Image Slider</span>
                        </button>
                        
                        <button type="button" onclick="selectMediaType('Video')" 
                                class="media-type-btn @(Model.MediaType == PazarAtlasi.CMS.Domain.Common.MediaType.Video ? "active" : "")"
                                data-media-type="Video">
                            <i class="fas fa-video text-2xl mb-2"></i>
                            <span class="text-sm font-medium">Video</span>
                        </button>
                    </div>
                </div>

                <!-- Single Image Upload -->
                <div id="singleImageUpload" class="media-upload-section" style="display: @(Model.MediaType == PazarAtlasi.CMS.Domain.Common.MediaType.Image ? "block" : "none")">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Upload Image</label>
                    <div class="border-2 border-dashed border-slate-300 rounded-lg p-4 text-center hover:border-purple-400 transition-colors">
                        @if (!string.IsNullOrEmpty(Model.PictureUrl))
                        {
                            <div class="relative inline-block">
                                <img src="@Model.PictureUrl" alt="Preview" class="max-h-40 rounded" id="singleImagePreview" />
                                <button type="button" onclick="removeSingleImage()" class="absolute top-2 right-2 bg-red-500 text-white rounded-full p-2 hover:bg-red-600">
                                    <i class="fas fa-trash text-xs"></i>
                                </button>
                            </div>
                        }
                        else
                        {
                            <div id="singleImagePlaceholder">
                                <i class="fas fa-cloud-upload-alt text-4xl text-slate-400 mb-2"></i>
                                <p class="text-sm text-slate-600 mb-2">Click to upload or drag and drop</p>
                                <p class="text-xs text-slate-500">PNG, JPG, GIF up to 5MB</p>
                            </div>
                            <img src="" alt="Preview" class="max-h-40 rounded hidden" id="singleImagePreview" />
                        }
                        <input type="file" id="singleImageInput" accept="image/*" class="hidden" onchange="handleSingleImageUpload(this)" />
                        <button type="button" onclick="document.getElementById('singleImageInput').click()" 
                                class="mt-3 py-2 px-4 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm transition-colors">
                            <i class="fas fa-upload mr-2"></i> Choose Image
                        </button>
                    </div>
                    <input type="hidden" id="pictureUrl" value="@Model.PictureUrl" />
                </div>

                <!-- Slider Images Upload -->
                <div id="sliderImagesUpload" class="media-upload-section" style="display: @(Model.MediaType == PazarAtlasi.CMS.Domain.Common.MediaType.ImageSlider ? "block" : "none")">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Upload Slider Images (3 images)</label>
                    <div class="grid grid-cols-3 gap-3" id="sliderImagesContainer">
                        @for (int i = 0; i < 3; i++)
                        {
                            var imageUrl = Model.SliderImages != null && Model.SliderImages.Count > i ? Model.SliderImages[i] : "";
                            <div class="border-2 border-dashed border-slate-300 rounded-lg p-3 text-center slider-image-slot" data-slot="@i">
                                @if (!string.IsNullOrEmpty(imageUrl))
                                {
                                    <div class="relative">
                                        <img src="@imageUrl" alt="Slider @(i+1)" class="w-full h-24 object-cover rounded" />
                                        <button type="button" onclick="removeSliderImage(@i)" 
                                                class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 text-xs">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                }
                                else
                                {
                                    <div class="h-24 flex flex-col items-center justify-center">
                                        <i class="fas fa-image text-2xl text-slate-400 mb-1"></i>
                                        <p class="text-xs text-slate-500">Image @(i + 1)</p>
                                    </div>
                                }
                                <input type="file" id="sliderImage@(i)" accept="image/*" class="hidden" onchange="handleSliderImageUpload(this, @i)" />
                                <button type="button" onclick="document.getElementById('sliderImage@(i)').click()" 
                                        class="mt-2 py-1 px-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded text-xs">
                                    <i class="fas fa-upload mr-1"></i> Upload
                                </button>
                            </div>
                        }
                    </div>
                </div>

                <!-- Video Upload -->
                <div id="videoUpload" class="media-upload-section" style="display: @(Model.MediaType == PazarAtlasi.CMS.Domain.Common.MediaType.Video ? "block" : "none")">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Upload Video</label>
                    <div class="border-2 border-dashed border-slate-300 rounded-lg p-4 text-center hover:border-purple-400 transition-colors">
                        @if (!string.IsNullOrEmpty(Model.VideoUrl))
                        {
                            <div class="relative inline-block w-full">
                                <video src="@Model.VideoUrl" class="max-h-40 rounded mx-auto" controls id="videoPreview"></video>
                                <button type="button" onclick="removeVideo()" class="absolute top-2 right-2 bg-red-500 text-white rounded-full p-2 hover:bg-red-600">
                                    <i class="fas fa-trash text-xs"></i>
                                </button>
                            </div>
                        }
                        else
                        {
                            <div id="videoPlaceholder">
                                <i class="fas fa-video text-4xl text-slate-400 mb-2"></i>
                                <p class="text-sm text-slate-600 mb-2">Click to upload video</p>
                                <p class="text-xs text-slate-500">MP4, WebM up to 50MB</p>
                            </div>
                            <video src="" class="max-h-40 rounded mx-auto hidden" controls id="videoPreview"></video>
                        }
                        <input type="file" id="videoInput" accept="video/*" class="hidden" onchange="handleVideoUpload(this)" />
                        <button type="button" onclick="document.getElementById('videoInput').click()" 
                                class="mt-3 py-2 px-4 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm transition-colors">
                            <i class="fas fa-upload mr-2"></i> Choose Video
                        </button>
                    </div>
                    <input type="hidden" id="videoUrl" value="@Model.VideoUrl" />
                </div>
        </div>

        <!-- Content Translations -->
        <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
            <h4 class="font-medium text-slate-800 mb-4 flex items-center">
                <i class="fas fa-language mr-2 text-blue-600"></i> Content & Translations
            </h4>
            
            <div class="space-y-4" id="translationsContainer">
                @foreach (var lang in Model.AvailableLanguages)
                {
                    var translation = Model.Translations.FirstOrDefault(t => t.LanguageId == lang.Id);
                    <div class="translation-item border border-slate-200 rounded-lg p-4 bg-white" data-language-id="@lang.Id">
                        <div class="flex items-center justify-between mb-3">
                            <span class="font-medium text-slate-700 flex items-center">
                                <i class="fas fa-flag mr-2 text-purple-600"></i> @lang.Name (@lang.Code)
                                @if (lang.IsDefault)
                                {
                                    <span class="ml-2 px-2 py-0.5 bg-green-100 text-green-800 text-xs rounded">Default</span>
                                }
                            </span>
                        </div>
                        
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Title</label>
                                <input type="text" class="translation-title w-full px-3 py-2 border border-slate-300 rounded-lg text-sm"
                                       value="@(translation?.Title ?? "")" placeholder="Enter title" />
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Description</label>
                                <textarea class="translation-description w-full px-3 py-2 border border-slate-300 rounded-lg text-sm" rows="3"
                                          placeholder="Enter description">@(translation?.Description ?? "")</textarea>
                            </div>
                            
                            @if (Model.IsHeroSection)
                            {
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-700 mb-1">Button Text</label>
                                        <input type="text" class="translation-button-text w-full px-3 py-2 border border-slate-300 rounded-lg text-sm"
                                               value="@(translation?.ButtonText ?? "")" placeholder="e.g., Learn More" />
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-700 mb-1">Button URL</label>
                                        <input type="text" class="translation-button-url w-full px-3 py-2 border border-slate-300 rounded-lg text-sm"
                                               value="@(translation?.ButtonUrl ?? "")" placeholder="e.g., /about" />
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex items-center justify-end space-x-3 pt-4 border-t border-slate-200">
            <button type="button" onclick="closeSectionItemModal()" 
                    class="py-2 px-4 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg text-sm transition-colors">
                <i class="fas fa-times mr-2"></i> Cancel
            </button>
            <button type="button" onclick="saveSectionItem()" 
                    class="py-2 px-4 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm transition-colors">
                <i class="fas fa-save mr-2"></i> Save Section Item
            </button>
        </div>

    </form>
</div>

