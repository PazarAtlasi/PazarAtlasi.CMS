@model PazarAtlasi.CMS.Models.ViewModels.SectionItemViewModel
@using System.Text.Json
@{
    var config = ViewBag.Configuration as PazarAtlasi.CMS.Application.Dtos.TemplateConfiguration;
    var itemConfig = config?.ItemConfiguration;
    var isNewItem = ViewBag.IsNewItem as bool? ?? false;
    var itemIndex = ViewBag.ItemIndex as int? ?? 0;
}

<div class="section-item-card border border-slate-200 rounded-lg p-4 bg-white" data-item-id="@Model">
    <div class="flex items-center justify-between mb-3">
        <div class="flex items-center">
            @if (itemConfig?.UIConfiguration?.ShowReorder == true)
            {
                <div class="drag-handle cursor-move mr-2 p-2 text-slate-400 hover:text-slate-600">
                    <i class="fas fa-grip-vertical"></i>
                </div>
            }
            <span class="text-sm font-medium text-slate-700 item-number">Item #@(itemIndex + 1)</span>
        </div>
        @if (itemConfig?.AllowDynamicItems == true)
        {
            <button type="button" onclick="SectionModal.removeSectionItem('@Model')"
                    class="text-red-600 hover:text-red-800 text-sm">
                <i class="fas fa-trash"></i>
            </button>
        }
    </div>

    <div class="space-y-3">
        @if (itemConfig?.Fields != null)
        {
            @foreach (var field in itemConfig.Fields)
            {
                ViewBag.Field = field;
                ViewBag.Item = Model;
                ViewBag.Value = Model.Data != null && Model.Data.ContainsKey(field.Name) ? Model.Data[field.Name]?.ToString() : field.DefaultValue ?? "";
                
                @await Html.PartialAsync("~/Views/Shared/Content/_SectionItemField.cshtml", field)
            }
        }
    </div>
</div>