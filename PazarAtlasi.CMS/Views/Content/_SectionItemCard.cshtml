@model PazarAtlasi.CMS.Models.ViewModels.SectionItemViewModel
@{
    var availableLanguages = ViewBag.AvailableLanguages as List<PazarAtlasi.CMS.Models.ViewModels.LanguageViewModel> ?? new List<PazarAtlasi.CMS.Models.ViewModels.LanguageViewModel>();
}

<div class="section-item-card border-2 border-slate-300 rounded-lg p-4 bg-white shadow-sm hover:shadow-md transition-shadow"
     data-item-id="@Model.Id"
     data-template-id ="@Model.TemplateId"
     data-item-type="@((int)Model.Type)"
     data-level="@(ViewBag.Level ?? 0)">

    <div class="flex items-center justify-between mb-3 pb-3 border-b border-slate-200">
        <div class="flex items-center">
            @if (Model.AllowReorder)
            {
                <div class="drag-handle cursor-move mr-3 p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded">
                    <i class="fas fa-grip-vertical"></i>
                </div>
            }
            <div>
                <h5 class="text-sm font-semibold text-slate-800 item-number">
                    @if (!string.IsNullOrEmpty(Model.IconClass))
                    {
                        <i class="@Model.IconClass mr-2"></i>
                    }
                    @(Model.Title ?? Model.Type.ToString()) #@Model.SortOrder
                </h5>
                @if (!string.IsNullOrEmpty(Model.Description))
                {
                    <p class="text-xs text-slate-500 mt-0.5">@Model.Description</p>
                }
            </div>
        </div>
        <div class="flex items-center space-x-2">
            <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded">
                <i class="fas fa-check-circle mr-1"></i>Active
            </span>
            @if (Model.AllowRemove)
            {
                <button type="button" onclick="this.closest('.section-item-card').remove(); updateItemNumbers();"
                        class="text-red-600 hover:text-red-800 text-sm p-2 hover:bg-red-50 rounded transition-colors"
                        title="Remove this item">
                    <i class="fas fa-trash"></i>
                </button>
            }
        </div>
    </div>

    <!-- Render fields for this item -->
    <div class="space-y-3">
        @if (Model.Fields != null && Model.Fields.Any())
        {
            @foreach (var field in Model.Fields)
            {
                ViewBag.Level = 0;
                ViewBag.AvailableLanguages = availableLanguages;
                @await Html.PartialAsync("~/Views/Content/_SectionItemField.cshtml", field)
            }
        }
        else
        {
            <div class="text-center py-4 text-slate-400">
                <i class="fas fa-info-circle mr-2"></i>
                <span class="text-sm">No fields configured for this item type</span>
            </div>
        }

        <!-- Recursively render nested items -->
        @if (Model.ChildItems?.Any() == true)
        {
            ViewBag.ParentItem = Model;
            ViewBag.Level = 1;

            @await Html.PartialAsync("~/Views/Content/_SectionItemNested.cshtml")
        }
    </div>
</div>

