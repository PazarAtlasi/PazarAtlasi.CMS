@model PazarAtlasi.CMS.Models.ViewModels.PageEditViewModel

<!-- Page Sections -->
<div class="bg-white rounded-xl shadow-md">
    <div class="p-6 border-b border-slate-100">
        <div class="flex items-center justify-between">
            <h5 class="text-lg font-semibold text-slate-800 flex items-center">
                <i class="fas fa-layer-group mr-2 text-purple-600"></i>
                Page Sections (@(Model.Sections?.Count ?? 0))
            </h5>
            <button type="button" class="text-green-600 hover:text-green-700 text-sm" onclick="addNewSection()">
                <i class="fas fa-plus mr-1"></i> Add Section
            </button>
        </div>
    </div>
    <div class="p-6">
        <div id="sectionsContainer" class="space-y-6">
            @if (Model.Sections != null && Model.Sections.Any())
            {
                @for (int i = 0; i < Model.Sections.Count; i++)
                {
                    var currentSection = Model.Sections[i];
                    <div class="section-editor border border-slate-200 rounded-lg p-6" data-section-id="@currentSection.Id">
                        <!-- Section Header -->
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <div class="drag-handle cursor-move mr-3 p-2 text-slate-400 hover:text-slate-600">
                                    <i class="fas fa-grip-vertical"></i>
                                </div>
                                <div>
                                    <h6 class="font-medium text-slate-800">Section #@currentSection.Translations.FirstOrDefault()?.Title</h6>
                                    <p class="text-sm text-slate-500">@currentSection.Type.ToString() - Template System</p>
                                </div>
                                <span class="ml-4 px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded">
                                    @(currentSection.SectionItems?.Count ?? 0) items
                                </span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-slate-500">Order: @currentSection.SortOrder</span>
                                <button type="button" class="text-blue-600 hover:text-blue-800 p-1" onclick="toggleSectionSettings(@currentSection.Id)" title="Settings">
                                    <i class="fas fa-cog"></i>
                                </button>
                                <button type="button" class="text-green-600 hover:text-green-800 p-1" onclick="duplicateSection(@currentSection.Id)" title="Duplicate">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button type="button" class="text-red-600 hover:text-red-800 p-1" onclick="removeSection(@currentSection.Id)" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Section Settings (Hidden by default) -->
                        <div id="sectionSettings_@currentSection.Id" class="section-settings mb-4 p-4 bg-slate-50 rounded-lg" style="display: none;">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">Section Type</label>
                                    <select name="Sections[@i].Type" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm">
                                        @foreach (var sectionType in Enum.GetValues<PazarAtlasi.CMS.Domain.Common.SectionType>())
                                        {
                                            @if (currentSection.Type == sectionType)
                                            {
                                                <option value="@sectionType" selected>@sectionType.ToString()</option>
                                            }
                                            else
                                            {
                                                <option value="@sectionType">@sectionType.ToString()</option>
                                            }
                                        }
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">Template</label>
                                    <select name="Sections[@i].TemplateId" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm" onchange="updateSectionTemplate(@currentSection.Id, this.value)">
                                        <option value="">Select Template</option>
                                        <!-- Templates will be loaded dynamically based on section type -->
                                    </select>
                                    <p class="text-xs text-slate-500 mt-1">Templates will be available based on section type</p>
                                </div>
                            </div>
                        </div>

                        <!-- Section Items Preview -->
                        <div class="section-items-preview">
                            @if (currentSection.SectionItems != null && currentSection.SectionItems.Any())
                            {
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    @foreach (var item in currentSection.SectionItems.Take(3))
                                    {
                                        <div class="border border-slate-200 rounded-lg p-3">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-xs text-slate-500">@item.Type.ToString()</span>
                                                <button type="button" class="text-blue-600 hover:text-blue-800 text-xs" onclick="editSectionItems(@currentSection.Id)">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                            </div>
                                            <div class="text-sm font-medium text-slate-800 truncate">
                                                @(item.Translations?.FirstOrDefault()?.Title ?? "Untitled")
                                            </div>
                                            <div class="text-xs text-slate-500 truncate">
                                                @(item.Translations?.FirstOrDefault()?.Description ?? "No description")
                                            </div>
                                        </div>
                                    }
                                    @if (currentSection.SectionItems.Count > 3)
                                    {
                                        <div class="border border-dashed border-slate-300 rounded-lg p-3 flex items-center justify-center">
                                            <span class="text-sm text-slate-500">+@(currentSection.SectionItems.Count - 3) more items</span>
                                        </div>
                                    }
                                </div>
                                <div class="mt-4 text-center">
                                    <button type="button" class="text-blue-600 hover:text-blue-800 text-sm" onclick="editSectionItems(@currentSection.Id)">
                                        <i class="fas fa-edit mr-1"></i> Edit Section Items
                                    </button>
                                </div>
                            }
                            else
                            {
                                <div class="text-center py-8 text-slate-500">
                                    <i class="fas fa-plus-circle text-3xl mb-2"></i>
                                    <p class="text-sm">No items in this section</p>
                                    <button type="button" class="mt-2 text-blue-600 hover:text-blue-800 text-sm" onclick="addSectionItem(@currentSection.Id)">
                                        Add First Item
                                    </button>
                                </div>
                            }

                        </div>
                    </div>
                }
            }
            else
            {
                <div class="text-center py-12 text-slate-500">
                    <i class="fas fa-layer-group text-4xl mb-4"></i>
                    <h6 class="text-lg font-medium mb-2">No sections yet</h6>
                    <p class="text-sm mb-4">Start building your page by adding sections</p>
                    <button type="button" class="py-2 px-4 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm transition-colors" onclick="addNewSection()">
                        <i class="fas fa-plus mr-2"></i> Add Your First Section
                    </button>
                </div>
            }
        </div>
    </div>
</div>

<!-- Form Actions -->
<div class="bg-white rounded-xl shadow-md">
    <div class="p-6">
        <div class="flex items-center justify-between">
            <div class="text-sm text-slate-500">
                Last saved: <span class="font-medium">@DateTime.Now.ToString("MMM dd, yyyy HH:mm")</span>
            </div>
            <div class="flex items-center space-x-3">
                <button type="button" class="py-2 px-4 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg text-sm transition-colors">
                    Cancel
                </button>
                <button type="submit" class="py-2 px-4 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm transition-colors">
                    <i class="fas fa-save mr-2"></i> Save Changes
                </button>
            </div>
        </div>
    </div>
</div>