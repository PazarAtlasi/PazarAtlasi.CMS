@model PazarAtlasi.CMS.Application.Dtos.SectionItemFieldUpdateDto
@{
    var fieldIndex = ViewData["FieldIndex"] as int? ?? 0;
    var languages = ViewBag.Languages as List<PazarAtlasi.CMS.Domain.Entities.Content.Language> ?? new
    List<PazarAtlasi.CMS.Domain.Entities.Content.Language>();
}

<div class="card border mb-3" data-field-index="@fieldIndex">
    <div class="card-header bg-light d-flex justify-content-between align-items-center">
        <h6 class="card-title mb-0">
            <i class="fas fa-cog mr-1"></i>
            Field: @(Model.FieldName ?? "New Field")
            @if (Model.Required)
            {
                <span class="badge badge-danger ml-2">Required</span>
            }
            @if (Model.IsTranslatable)
            {
                <span class="badge badge-info ml-1">Translatable</span>
            }
        </h6>
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="toggleFieldDetails(@fieldIndex)"
                title="Toggle Details">
                <i class="fas fa-chevron-down" id="fieldToggleIcon_@fieldIndex"></i>
            </button>
            <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeField(@fieldIndex)"
                title="Remove Field">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </div>
    <div class="card-body" id="fieldDetails_@fieldIndex">
        <div class="row">
            <!-- Basic Field Information -->
            <div class="col-md-6">
                <div class="form-group">
                    <label asp-for="FieldKey" class="form-label">Field Key <span class="text-danger">*</span></label>
                    <input asp-for="FieldKey" class="form-control" placeholder="e.g., title, image, url" />
                    <small class="form-text text-muted">Unique identifier for this field</small>
                    <span asp-validation-for="FieldKey" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="FieldName" class="form-label">Field Name <span class="text-danger">*</span></label>
                    <input asp-for="FieldName" class="form-control" placeholder="e.g., Title, Image URL" />
                    <small class="form-text text-muted">Display name for this field</small>
                    <span asp-validation-for="FieldName" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="Type" class="form-label">Field Type <span class="text-danger">*</span></label>
                    <select asp-for="Type" class="form-control"
                        asp-items="@(new SelectList(ViewBag.SectionItemFieldTypes))">
                        <option value="">Select Type</option>
                    </select>
                    <span asp-validation-for="Type" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="SortOrder" class="form-label">Sort Order</label>
                    <input asp-for="SortOrder" class="form-control" type="number" />
                    <small class="form-text text-muted">Display order (lower numbers first)</small>
                    <span asp-validation-for="SortOrder" class="text-danger"></span>
                </div>
            </div>

            <!-- Field Settings -->
            <div class="col-md-6">
                <div class="form-group">
                    <label asp-for="Placeholder" class="form-label">Placeholder</label>
                    <input asp-for="Placeholder" class="form-control" placeholder="Enter placeholder text" />
                    <span asp-validation-for="Placeholder" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="DefaultValue" class="form-label">Default Value</label>
                    <input asp-for="DefaultValue" class="form-control" placeholder="Enter default value" />
                    <span asp-validation-for="DefaultValue" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="MaxLength" class="form-label">Max Length</label>
                    <input asp-for="MaxLength" class="form-control" type="number" min="1" />
                    <small class="form-text text-muted">Maximum character length (optional)</small>
                    <span asp-validation-for="MaxLength" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="OptionsJson" class="form-label">Options JSON</label>
                    <textarea asp-for="OptionsJson" class="form-control" rows="3"
                        placeholder='{"option1": "Value 1", "option2": "Value 2"}'></textarea>
                    <small class="form-text text-muted">JSON options for select/radio fields</small>
                    <span asp-validation-for="OptionsJson" class="text-danger"></span>
                </div>
            </div>
        </div>

        <!-- Field Settings Checkboxes -->
        <div class="row">
            <div class="col-12">
                <div class="form-check">
                    <input asp-for="Required" class="form-check-input" type="checkbox" />
                    <label asp-for="Required" class="form-check-label">
                        Required Field
                    </label>
                </div>

                <div class="form-check">
                    <input asp-for="IsTranslatable" class="form-check-input" type="checkbox" />
                    <label asp-for="IsTranslatable" class="form-check-label">
                        Translatable Field
                    </label>
                    <small class="form-text text-muted">Enable multi-language support for this field</small>
                </div>
            </div>
        </div>

        <!-- Field Translations -->
        @if (Model.IsTranslatable && Model.Translations.Any())
        {
            <div class="row mt-3">
                <div class="col-12">
                    <h6 class="text-muted mb-3">
                        <i class="fas fa-language mr-1"></i>
                        Field Translations
                    </h6>
                    <div class="row">
                        @for (int i = 0; i < Model.Translations.Count; i++)
                        {
                            var translation = Model.Translations[i];
                            var language = languages.FirstOrDefault(l => l.Id == translation.LanguageId);

                            <div class="col-md-4 mb-3">
                                <div class="card border-light">
                                    <div class="card-header bg-light py-2">
                                        <h6 class="card-title mb-0 text-sm">
                                            @(language?.Name ?? "Unknown Language")
                                            <small class="text-muted">(@(language?.Code ?? "N/A"))</small>
                                        </h6>
                                    </div>
                                    <div class="card-body py-2">
                                        <input type="hidden" asp-for="Translations[i].Id" />
                                        <input type="hidden" asp-for="Translations[i].SectionItemFieldId" />
                                        <input type="hidden" asp-for="Translations[i].LanguageId" />

                                        <div class="form-group mb-2">
                                            <label asp-for="Translations[i].Label" class="form-label text-sm">Label</label>
                                            <input asp-for="Translations[i].Label" class="form-control form-control-sm"
                                                placeholder="Field label" />
                                            <span asp-validation-for="Translations[i].Label" class="text-danger"></span>
                                        </div>

                                        <div class="form-group mb-2">
                                            <label asp-for="Translations[i].Description"
                                                class="form-label text-sm">Description</label>
                                            <textarea asp-for="Translations[i].Description" class="form-control form-control-sm"
                                        rows="2" placeholder="Field description"></textarea>
                                            <span asp-validation-for="Translations[i].Description" class="text-danger"></span>
                                        </div>

                                        <div class="form-group mb-0">
                                            <label asp-for="Translations[i].Placeholder"
                                                class="form-label text-sm">Placeholder</label>
                                            <input asp-for="Translations[i].Placeholder" class="form-control form-control-sm"
                                                placeholder="Placeholder text" />
                                            <span asp-validation-for="Translations[i].Placeholder" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }

        <!-- Hidden fields for form binding -->
        <input type="hidden" asp-for="Id" />
        <input type="hidden" asp-for="SectionItemId" />
    </div>
</div>

<script>
    function toggleFieldDetails(fieldIndex) {
        const details = document.getElementById('fieldDetails_' + fieldIndex);
        const icon = document.getElementById('fieldToggleIcon_' + fieldIndex);

        if (details.style.display === 'none') {
            details.style.display = 'block';
            icon.className = 'fas fa-chevron-down';
        } else {
            details.style.display = 'none';
            icon.className = 'fas fa-chevron-right';
        }
    }

    function removeField(fieldIndex) {
        if (confirm('Are you sure you want to remove this field?')) {
            const fieldCard = document.querySelector('[data-field-index="' + fieldIndex + '"]');
            if (fieldCard) {
                fieldCard.remove();
            }
        }
    }
</script>