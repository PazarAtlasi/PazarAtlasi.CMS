@model PazarAtlasi.CMS.Models.ViewModels.DataSchemaEditViewModel

@{
    ViewData["Title"] = "Şema Düzenle";
}

<div class="bg-white rounded-xl shadow-md">
    <!-- Header -->
    <div class="p-6 border-b border-slate-200">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold text-slate-800 mb-2">
                    <i class="fas fa-edit text-blue-600 mr-3"></i>
                    Şema Düzenle
                </h1>
                <p class="text-slate-600">Şema bilgilerini ve alanlarını güncelleyin</p>
            </div>
            <div class="flex items-center space-x-3">
                <a href="@Url.Action("DataSchemas")" 
                   class="bg-slate-500 hover:bg-slate-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Geri Dön
                </a>
            </div>
        </div>
    </div>

    <form asp-action="EditDataSchema" method="post" id="editSchemaForm" class="p-6">
        <input type="hidden" asp-for="Id" />
        <div asp-validation-summary="ModelOnly" class="text-red-600 mb-4"></div>

        <!-- Basic Information -->
        <div class="mb-8">
            <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center">
                <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                Temel Bilgiler
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label asp-for="Name" class="block text-sm font-medium text-slate-700 mb-2">Şema Adı *</label>
                    <input asp-for="Name" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                           placeholder="Şema adı" required>
                    <span asp-validation-for="Name" class="text-red-500 text-sm"></span>
                </div>
                <div>
                    <label asp-for="Key" class="block text-sm font-medium text-slate-700 mb-2">Şema Anahtarı *</label>
                    <input asp-for="Key" class="w-full px-4 py-2 border border-slate-300 rounded-lg bg-slate-50 cursor-not-allowed" 
                           placeholder="schema-key" readonly>
                    <span asp-validation-for="Key" class="text-red-500 text-sm"></span>
                    <p class="text-xs text-slate-500 mt-1">Anahtar oluşturulduktan sonra değiştirilemez</p>
                </div>
                <div>
                    <label asp-for="SortOrder" class="block text-sm font-medium text-slate-700 mb-2">Sıralama</label>
                    <input asp-for="SortOrder" type="number" min="0" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <span asp-validation-for="SortOrder" class="text-red-500 text-sm"></span>
                </div>
            </div>
            <div class="mt-4">
                <label asp-for="Description" class="block text-sm font-medium text-slate-700 mb-2">Açıklama</label>
                <textarea asp-for="Description" rows="3" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                          placeholder="Şema açıklaması"></textarea>
                <span asp-validation-for="Description" class="text-red-500 text-sm"></span>
            </div>
            <div class="mt-4 flex items-center">
                <input asp-for="IsActive" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-slate-300 rounded">
                <label asp-for="IsActive" class="ml-2 block text-sm text-slate-700">Aktif</label>
            </div>
        </div>

        <!-- Translations -->
        <div class="mb-8">
            <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center">
                <i class="fas fa-language text-green-600 mr-2"></i>
                Çoklu Dil Desteği
            </h3>
            
            <!-- Language Tabs -->
            <div class="border-b border-slate-200 mb-4">
                <nav class="-mb-px flex space-x-8" id="languageTabs">
                    @for (int i = 0; i < Model.AvailableLanguages.Count; i++)
                    {
                        var language = Model.AvailableLanguages[i];
                        <button type="button" 
                                class="language-tab py-2 px-1 border-b-2 font-medium text-sm transition-colors @(language.IsDefault ? "border-blue-500 text-blue-600" : "border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300")"
                                data-language-id="@language.Id"
                                onclick="switchLanguageTab(@language.Id)">
                            @language.Name
                            @if (language.IsDefault)
                            {
                                <span class="ml-1 text-xs bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded">Varsayılan</span>
                            }
                        </button>
                    }
                </nav>
            </div>

            <!-- Translation Content -->
            @for (int i = 0; i < Model.Translations.Count; i++)
            {
                var translation = Model.Translations[i];
                <div class="translation-content @(translation.IsDefault ? "" : "hidden")" data-language-id="@translation.LanguageId">
                    <input type="hidden" asp-for="Translations[i].LanguageId" value="@translation.LanguageId" />
                    <input type="hidden" asp-for="Translations[i].LanguageName" value="@translation.LanguageName" />
                    <input type="hidden" asp-for="Translations[i].LanguageCode" value="@translation.LanguageCode" />
                    <input type="hidden" asp-for="Translations[i].IsDefault" value="@translation.IsDefault" />
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Şema Adı (@translation.LanguageName)</label>
                        <input asp-for="Translations[i].Name" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                               placeholder="@translation.LanguageName dilinde şema adı">
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-slate-700 mb-2">Açıklama (@translation.LanguageName)</label>
                        <textarea asp-for="Translations[i].Description" rows="3" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                  placeholder="@translation.LanguageName dilinde açıklama"></textarea>
                    </div>
                </div>
            }
        </div>

        <!-- Fields -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-slate-800 flex items-center">
                    <i class="fas fa-list text-purple-600 mr-2"></i>
                    Şema Alanları
                </h3>
                <button type="button" onclick="addField()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center">
                    <i class="fas fa-plus mr-2"></i>
                    Alan Ekle
                </button>
            </div>

            <div id="fieldsContainer">
                @if (Model.Fields != null && Model.Fields.Any())
                {
                    @for (int i = 0; i < Model.Fields.Count; i++)
                    {
                        var field = Model.Fields[i];
                        <div class="field-item bg-slate-50 border border-slate-200 rounded-lg p-4 mb-4" data-field-index="@i">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-semibold text-slate-800">Alan #@(i + 1)</h4>
                                <button type="button" onclick="removeField(this)" class="text-red-600 hover:text-red-800">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            
                            <input type="hidden" name="Fields[@i].DataSchemaId" value="@field.DataSchemaId" />
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">Alan Anahtarı *</label>
                                    <input type="text" name="Fields[@i].FieldKey" value="@field.FieldKey" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">Alan Adı *</label>
                                    <input type="text" name="Fields[@i].FieldName" value="@field.FieldName" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">Alan Tipi *</label>
                                    <select name="Fields[@i].Type" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required>
                                        <option value="">Seçiniz</option>
                                        @{
                                            var fieldTypeValue = field.Type.ToString();
                                        }
                                        <option value="Text" selected="@(fieldTypeValue == "Text")">Text</option>
                                        <option value="TextArea" selected="@(fieldTypeValue == "TextArea")">Text Area</option>
                                        <option value="Number" selected="@(fieldTypeValue == "Number")">Number</option>
                                        <option value="Boolean" selected="@(fieldTypeValue == "Boolean")">Boolean</option>
                                        <option value="Date" selected="@(fieldTypeValue == "Date")">Date</option>
                                        <option value="Select" selected="@(fieldTypeValue == "Select")">Select</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">Sıralama</label>
                                    <input type="number" name="Fields[@i].SortOrder" value="@field.SortOrder" class="w-full px-3 py-2 border border-slate-300 rounded-lg">
                                </div>
                            </div>
                            
                            <div class="mt-4 flex items-center space-x-4">
                                <label class="flex items-center">
                                    <input type="checkbox" name="Fields[@i].IsRequired" value="true" @(field.IsRequired ? "checked" : "") class="h-4 w-4 text-blue-600 rounded">
                                    <span class="ml-2 text-sm text-slate-700">Zorunlu</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" 
                                           id="field_@(i)_IsTranslatable"
                                           name="Fields[@i].IsTranslatable" 
                                           value="true" 
                                           @(field.IsTranslatable ? "checked" : "") 
                                           class="h-4 w-4 text-blue-600 rounded"
                                           onchange="toggleFieldTranslations(@i)">
                                    <span class="ml-2 text-sm text-slate-700">Çevrilebilir</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="Fields[@i].IsActive" value="true" @(field.IsActive ? "checked" : "") class="h-4 w-4 text-blue-600 rounded">
                                    <span class="ml-2 text-sm text-slate-700">Aktif</span>
                                </label>
                            </div>
                            
                            <!-- Field Translations (Collapsible) -->
                            <div id="fieldTranslations_@i" class="mt-4 @(field.IsTranslatable ? "" : "hidden")">
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                    <h5 class="text-sm font-semibold text-slate-800 mb-3 flex items-center">
                                        <i class="fas fa-language text-green-600 mr-2"></i>
                                        Alan Çevirileri
                                    </h5>
                                    
                                    <!-- Language Tabs for Field -->
                                    <div class="border-b border-slate-200 mb-3">
                                        <nav class="-mb-px flex space-x-4">
                                            @for (int langIdx = 0; langIdx < Model.AvailableLanguages.Count; langIdx++)
                                            {
                                                var lang = Model.AvailableLanguages[langIdx];
                                                <button type="button" 
                                                        class="field-translation-tab-@(i) py-2 px-1 border-b-2 font-medium text-xs transition-colors @(lang.IsDefault ? "border-green-500 text-green-600" : "border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300")"
                                                        data-field-index="@i"
                                                        data-tab-index="@langIdx"
                                                        onclick="switchFieldTranslationTab(@i, @langIdx)">
                                                    @lang.Name
                                                    @if (lang.IsDefault)
                                                    {
                                                        <span class="ml-1 text-xs">●</span>
                                                    }
                                                </button>
                                            }
                                        </nav>
                                    </div>
                                    
                                    <!-- Translation Content for Each Language -->
                                    @for (int langIdx = 0; langIdx < Model.AvailableLanguages.Count; langIdx++)
                                    {
                                        var lang = Model.AvailableLanguages[langIdx];
                                        var fieldTranslation = field.Translations?.FirstOrDefault(t => t.LanguageId == lang.Id);
                                        
                                        <div id="fieldTranslationTab_@(i)_@(langIdx)" 
                                             class="field-translation-content-@(i) @(lang.IsDefault ? "" : "hidden")">
                                            <input type="hidden" name="Fields[@i].Translations[@langIdx].LanguageId" value="@lang.Id" />
                                            
                                            <div class="space-y-3">
                                                <div>
                                                    <label class="block text-xs font-medium text-slate-700 mb-1">
                                                        Alan Adı (@lang.Name)
                                                    </label>
                                                    <input type="text" 
                                                           name="Fields[@i].Translations[@langIdx].FieldName" 
                                                           value="@(fieldTranslation?.FieldName ?? "")"
                                                           class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                                           placeholder="@lang.Name dilinde alan adı">
                                                </div>
                                                <div>
                                                    <label class="block text-xs font-medium text-slate-700 mb-1">
                                                        Açıklama (@lang.Name)
                                                    </label>
                                                    <textarea name="Fields[@i].Translations[@langIdx].Description" 
                                                              rows="2"
                                                              class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                                              placeholder="@lang.Name dilinde açıklama">@(fieldTranslation?.Description ?? "")</textarea>
                                                </div>
                                                <div>
                                                    <label class="block text-xs font-medium text-slate-700 mb-1">
                                                        Placeholder (@lang.Name)
                                                    </label>
                                                    <input type="text" 
                                                           name="Fields[@i].Translations[@langIdx].Placeholder" 
                                                           value="@(fieldTranslation?.Placeholder ?? "")"
                                                           class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                                           placeholder="@lang.Name dilinde placeholder">
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>

            @if (Model.Fields == null || !Model.Fields.Any())
            {
                <!-- Empty State -->
                <div id="fieldsEmptyState" class="text-center py-8 border-2 border-dashed border-slate-300 rounded-lg">
                    <div class="mx-auto h-12 w-12 text-slate-400 mb-4">
                        <i class="fas fa-list text-3xl"></i>
                    </div>
                    <h3 class="text-sm font-medium text-slate-900 mb-2">Henüz alan eklenmedi</h3>
                    <p class="text-sm text-slate-500 mb-4">Şemanız için alanlar ekleyin</p>
                    <button type="button" onclick="addField()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                        İlk Alanı Ekle
                    </button>
                </div>
            }
        </div>

        <!-- Actions -->
        <div class="flex items-center justify-between pt-6 border-t border-slate-200">
            <a href="@Url.Action("DataSchemas")" class="text-slate-600 hover:text-slate-800 transition-colors">
                <i class="fas fa-times mr-2"></i>
                İptal
            </a>
            <div class="flex items-center space-x-3">
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors">
                    <i class="fas fa-save mr-2"></i>
                    Şemayı Güncelle
                </button>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script src="~/js/metadata/PazarAtlasi.MetaData.DataSchema.js" asp-append-version="true"></script>
    <script>
        let fieldIndex = @(Model.Fields?.Count ?? 0);

        // Initialize the form
        $(document).ready(function() {
            DataSchemaManager.init();
            updateEmptyState();
        });

        // Language tab switching
        function switchLanguageTab(languageId) {
            // Hide all translation contents
            document.querySelectorAll('.translation-content').forEach(content => {
                content.classList.add('hidden');
            });

            // Show selected translation content
            const selectedContent = document.querySelector(`.translation-content[data-language-id="${languageId}"]`);
            if (selectedContent) {
                selectedContent.classList.remove('hidden');
            }

            // Update tab styles
            document.querySelectorAll('.language-tab').forEach(tab => {
                tab.classList.remove('border-blue-500', 'text-blue-600');
                tab.classList.add('border-transparent', 'text-slate-500');
            });

            const selectedTab = document.querySelector(`.language-tab[data-language-id="${languageId}"]`);
            if (selectedTab) {
                selectedTab.classList.remove('border-transparent', 'text-slate-500');
                selectedTab.classList.add('border-blue-500', 'text-blue-600');
            }
        }

        // Toggle field translations visibility
        function toggleFieldTranslations(fieldIndex) {
            const checkbox = document.getElementById('field_' + fieldIndex + '_IsTranslatable');
            const translationsDiv = document.getElementById('fieldTranslations_' + fieldIndex);

            if (checkbox && translationsDiv) {
                if (checkbox.checked) {
                    translationsDiv.classList.remove('hidden');
                    translationsDiv.style.opacity = '0';
                    translationsDiv.style.transform = 'translateY(-10px)';
                    setTimeout(() => {
                        translationsDiv.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
                        translationsDiv.style.opacity = '1';
                        translationsDiv.style.transform = 'translateY(0)';
                    }, 10);
                } else {
                    translationsDiv.classList.add('hidden');
                }
            }
        }

        // Switch field translation tabs
        function switchFieldTranslationTab(fieldIndex, tabIndex) {
            // Hide all tab contents for this field
            const allContents = document.querySelectorAll('.field-translation-content-' + fieldIndex);
            allContents.forEach(content => {
                content.classList.add('hidden');
            });

            // Remove active class from all tabs
            const allTabs = document.querySelectorAll('.field-translation-tab-' + fieldIndex);
            allTabs.forEach(tab => {
                tab.classList.remove('border-green-500', 'text-green-600');
                tab.classList.add('border-transparent', 'text-slate-500');
            });

            // Show selected tab content
            const selectedContent = document.getElementById('fieldTranslationTab_' + fieldIndex + '_' + tabIndex);
            if (selectedContent) {
                selectedContent.classList.remove('hidden');
            }

            // Add active class to selected tab
            const selectedTab = document.querySelector('.field-translation-tab-' + fieldIndex + '[data-tab-index="' + tabIndex + '"]');
            if (selectedTab) {
                selectedTab.classList.add('border-green-500', 'text-green-600');
                selectedTab.classList.remove('border-transparent', 'text-slate-500');
            }
        }

        // Add field functionality
        function addField() {
            const container = document.getElementById('fieldsContainer');
            const emptyState = document.getElementById('fieldsEmptyState');
            
            if (emptyState) {
                emptyState.remove();
            }

            // Build translations HTML for all languages
            let translationsHtml = '';
            @for (int langIdx = 0; langIdx < Model.AvailableLanguages.Count; langIdx++)
            {
                var lang = Model.AvailableLanguages[langIdx];
                <text>
                translationsHtml += `
                    <div id="fieldTranslationTab_${fieldIndex}_@langIdx" 
                         class="field-translation-content-${fieldIndex} @(lang.IsDefault ? "" : "hidden")">
                        <input type="hidden" name="Fields[${fieldIndex}].Translations[@langIdx].LanguageId" value="@lang.Id" />
                        
                        <div class="space-y-3">
                            <div>
                                <label class="block text-xs font-medium text-slate-700 mb-1">
                                    Alan Adı (@lang.Name)
                                </label>
                                <input type="text" 
                                       name="Fields[${fieldIndex}].Translations[@langIdx].Label" 
                                       class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                       placeholder="@lang.Name dilinde alan adı">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-slate-700 mb-1">
                                    Açıklama (@lang.Name)
                                </label>
                                <textarea name="Fields[${fieldIndex}].Translations[@langIdx].Description" 
                                          rows="2"
                                          class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                          placeholder="@lang.Name dilinde açıklama"></textarea>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-slate-700 mb-1">
                                    Placeholder (@lang.Name)
                                </label>
                                <input type="text" 
                                       name="Fields[${fieldIndex}].Translations[@langIdx].Placeholder" 
                                       class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                                       placeholder="@lang.Name dilinde placeholder">
                            </div>
                        </div>
                    </div>
                `;
                </text>
            }

            const fieldHtml = `
                <div class="field-item bg-slate-50 border border-slate-200 rounded-lg p-4 mb-4" data-field-index="${fieldIndex}">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="font-semibold text-slate-800">Alan #${fieldIndex + 1}</h4>
                        <button type="button" onclick="removeField(this)" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    
                    <input type="hidden" name="Fields[${fieldIndex}].DataSchemaId" value="@Model.Id" />
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Alan Anahtarı *</label>
                            <input type="text" name="Fields[${fieldIndex}].FieldKey" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Alan Adı *</label>
                            <input type="text" name="Fields[${fieldIndex}].FieldName" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Alan Tipi *</label>
                            <select name="Fields[${fieldIndex}].Type" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required>
                                <option value="">Seçiniz</option>
                                <option value="Text">Text</option>
                                <option value="TextArea">Text Area</option>
                                <option value="Number">Number</option>
                                <option value="Boolean">Boolean</option>
                                <option value="Date">Date</option>
                                <option value="Select">Select</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Sıralama</label>
                            <input type="number" name="Fields[${fieldIndex}].SortOrder" value="${fieldIndex}" class="w-full px-3 py-2 border border-slate-300 rounded-lg">
                        </div>
                    </div>
                    
                    <div class="mt-4 flex items-center space-x-4">
                        <label class="flex items-center">
                            <input type="checkbox" name="Fields[${fieldIndex}].IsRequired" value="true" class="h-4 w-4 text-blue-600 rounded">
                            <span class="ml-2 text-sm text-slate-700">Zorunlu</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" 
                                   id="field_${fieldIndex}_IsTranslatable"
                                   name="Fields[${fieldIndex}].IsTranslatable" 
                                   value="true" 
                                   class="h-4 w-4 text-blue-600 rounded"
                                   onchange="toggleFieldTranslations(${fieldIndex})">
                            <span class="ml-2 text-sm text-slate-700">Çevrilebilir</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="Fields[${fieldIndex}].IsActive" value="true" checked class="h-4 w-4 text-blue-600 rounded">
                            <span class="ml-2 text-sm text-slate-700">Aktif</span>
                        </label>
                    </div>
                    
                    <!-- Field Translations (Collapsible) -->
                    <div id="fieldTranslations_${fieldIndex}" class="mt-4 hidden">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h5 class="text-sm font-semibold text-slate-800 mb-3 flex items-center">
                                <i class="fas fa-language text-green-600 mr-2"></i>
                                Alan Çevirileri
                            </h5>
                            
                            <!-- Language Tabs for Field -->
                            <div class="border-b border-slate-200 mb-3">
                                <nav class="-mb-px flex space-x-4">
                                    @for (int langIdx = 0; langIdx < Model.AvailableLanguages.Count; langIdx++)
                                    {
                                        var lang = Model.AvailableLanguages[langIdx];
                                        <text>
                                        <button type="button" 
                                                class="field-translation-tab-${fieldIndex} py-2 px-1 border-b-2 font-medium text-xs transition-colors @(lang.IsDefault ? "border-green-500 text-green-600" : "border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300")"
                                                data-field-index="${fieldIndex}"
                                                data-tab-index="@langIdx"
                                                onclick="switchFieldTranslationTab(${fieldIndex}, @langIdx)">
                                            @lang.Name
                                            @if (lang.IsDefault)
                                            {
                                                <text><span class="ml-1 text-xs">●</span></text>
                                            }
                                        </button>
                                        </text>
                                    }
                                </nav>
                            </div>
                            
                            <!-- Translation Content for Each Language -->
                            ${translationsHtml}
                        </div>
                    </div>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', fieldHtml);
            fieldIndex++;
            updateEmptyState();
        }

        // Remove field
        function removeField(button) {
            const fieldItem = button.closest('.field-item');
            if (fieldItem) {
                Swal.fire({
                    title: 'Emin misiniz?',
                    text: 'Bu alanı silmek istediğinizden emin misiniz?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Evet, Sil',
                    cancelButtonText: 'İptal',
                    confirmButtonColor: '#dc2626',
                    cancelButtonColor: '#64748b'
                }).then((result) => {
                    if (result.isConfirmed) {
                        fieldItem.remove();
                        updateEmptyState();
                    }
                });
            }
        }

        // Update empty state visibility
        function updateEmptyState() {
            const container = document.getElementById('fieldsContainer');
            const fields = container.querySelectorAll('.field-item');
            
            if (fields.length === 0 && !document.getElementById('fieldsEmptyState')) {
                const emptyStateHtml = `
                    <div id="fieldsEmptyState" class="text-center py-8 border-2 border-dashed border-slate-300 rounded-lg">
                        <div class="mx-auto h-12 w-12 text-slate-400 mb-4">
                            <i class="fas fa-list text-3xl"></i>
                        </div>
                        <h3 class="text-sm font-medium text-slate-900 mb-2">Henüz alan eklenmedi</h3>
                        <p class="text-sm text-slate-500 mb-4">Şemanız için alanlar ekleyin</p>
                        <button type="button" onclick="addField()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                            İlk Alanı Ekle
                        </button>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', emptyStateHtml);
            }
        }
    </script>
}

